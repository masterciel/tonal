<!DOCTYPE html>

<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>index.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="prelude">Prelude</h4>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Parse note names with <code>note-parser</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> noteParse = <span class="hljs-built_in">require</span>(<span class="hljs-string">'note-parser'</span>).parse</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Parse interval names with <code>interval-notation</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> ivlNttn = <span class="hljs-built_in">require</span>(<span class="hljs-string">'interval-notation'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Utilities</p>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Is an array?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isArr = <span class="hljs-built_in">Array</span>.isArray</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Is a number?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isNum = (n) =&gt; <span class="hljs-keyword">typeof</span> n === <span class="hljs-string">'number'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Is string?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isStr = (o) =&gt; <span class="hljs-keyword">typeof</span> o === <span class="hljs-string">'string'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Is defined? (can be null)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isDef = (o) =&gt; <span class="hljs-keyword">typeof</span> o !== <span class="hljs-string">'undefined'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Is a value?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isValue = (v) =&gt; v !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-keyword">typeof</span> v !== <span class="hljs-string">'undefined'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><strong>Functional helpers</strong></p>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Identity function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> id = (x) =&gt; x</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2 id="1-pitches">1. Pitches</h2>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>An array with the signature: <code>[&#39;tnl&#39;, fifths, octaves, direction]</code>:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-comment">/**
 * Create a pitch class in array notation
 *
 * @function
 * @param {Integer} fifhts - the number of fifths from C
 * @return {Pitch} the pitch in array notation
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> pcArr = (f) =&gt; [<span class="hljs-string">'tnl'</span>, f]

<span class="hljs-comment">/**
 * Create a note pitch in array notation
 *
 * @function
 * @param {Integer} fifhts - the number of fifths from C
 * @param {Integer} octaves - the number of encoded octaves
 * @return {Pitch} the pitch in array notation
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> noteArr = (f, o) =&gt; [<span class="hljs-string">'tnl'</span>, f, o]</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>calculate interval direction</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> calcDir = (f, o) =&gt; encDir(<span class="hljs-number">7</span> * f + <span class="hljs-number">12</span> * o)

<span class="hljs-comment">/**
 * Create an interval in array notation
 *
 * @function
 * @param {Integer} fifhts - the number of fifths from C
 * @param {Integer} octaves - the number of encoded octaves
 * @param {Integer} dir - (Optional) the direction
 * @return {Pitch} the pitch in array notation
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> ivlPitch = (f, o, d) =&gt; [<span class="hljs-string">'tnl'</span>, f, o, d || calcDir(f, o) ]

<span class="hljs-comment">/**
 * Test if a given object is a pitch
 * @function
 * @param {Object} obj - the object to test
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isPitch = (p) =&gt; p &amp;&amp; p[<span class="hljs-number">0</span>] === <span class="hljs-string">'tnl'</span>
<span class="hljs-comment">/**
 * Test if a given object is a pitch class
 * @function
 * @param {Object} obj - the object to test
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isPitchClass = (p) =&gt; isPitch(p) &amp;&amp; p.length === <span class="hljs-number">2</span>
<span class="hljs-comment">/**
 * Test if a given object is a pitch with octave (note pitch or interval)
 * @function
 * @param {Object} obj - the object to test
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> hasOct = (p) =&gt; isPitch(p) &amp;&amp; isNum(p[<span class="hljs-number">2</span>])
<span class="hljs-comment">/**
 * Test if a given object is a note pitch
 * @function
 * @param {Object} obj - the object to test
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isNotePitch = (p) =&gt; hasOct(p) &amp;&amp; p.length === <span class="hljs-number">3</span>
<span class="hljs-comment">/**
 * Test if a given object is a pitch interval
 * @function
 * @param {Object} obj - the object to test
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isIvlPitch = (i) =&gt; hasOct(i) &amp;&amp; isNum(i[<span class="hljs-number">3</span>])
<span class="hljs-comment">/**
 * Test if a given object is a pitch, but not an interval
 * @function
 * @param {Object} obj - the object to test
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isPitchNotIvl = (i) =&gt; isPitch(i) &amp;&amp; !isDef(i[<span class="hljs-number">3</span>])</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h4 id="pitch-encoding">Pitch encoding</h4>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Map from letter step to number of fifths and octaves
equivalent to: { C: 0, D: 2, E: 4, F: -1, G: 1, A: 3, B: 5 }</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> FIFTHS = [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Encode a pitch class using the step number and alteration</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> encPC = (step, alt) =&gt; FIFTHS[step] + <span class="hljs-number">7</span> * alt</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Given a number of fifths, return the octaves they span</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> fOcts = (f) =&gt; <span class="hljs-built_in">Math</span>.floor(f * <span class="hljs-number">7</span> / <span class="hljs-number">12</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Get the number of octaves it span each step</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> FIFTH_OCTS = FIFTHS.map(fOcts)</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Encode octaves</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> encOct = (step, alt, oct) =&gt; oct - FIFTH_OCTS[step] - <span class="hljs-number">4</span> * alt</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Encode direction</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> encDir = (n) =&gt; n &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">-1</span> : <span class="hljs-number">1</span>

<span class="hljs-comment">/**
 * Create a pitch. A pitch in tonal may refer to a pitch class, the pitch
 * of a note or an interval.
 *
 * @param {Integer} step - an integer from 0 to 6 representing letters
 * from C to B or simple interval numbers from unison to seventh
 * @param {Integer} alt - the alteration
 * @param {Integer} oct - the pitch octave
 * @param {Integer} dir - (Optional, intervals only) The interval direction
 * @return {Pitch} the pitch encoded as array notation
 *
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encode</span> (<span class="hljs-params">step, alt, oct, dir</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>is valid step?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (step &lt; <span class="hljs-number">0</span> || step &gt; <span class="hljs-number">6</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

  <span class="hljs-keyword">const</span> pc = encPC(step, alt || <span class="hljs-number">0</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>if not octave, return the pitch class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (!isNum(oct)) <span class="hljs-keyword">return</span> pcArr(pc)

  <span class="hljs-keyword">const</span> o = encOct(step, alt, oct)</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>if not direction, return a note pitch</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (!isNum(dir)) <span class="hljs-keyword">return</span> noteArr(pc, o)

  <span class="hljs-keyword">const</span> d = encDir(dir)</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>return the interval</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> ivlPitch(d * pc, d * o, d)
}</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h3 id="pitch-decoding">Pitch decoding</h3>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>remove accidentals to a pitch class
it gets an array and return a number of fifths</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unaltered</span> (<span class="hljs-params">f</span>) </span>{
  <span class="hljs-keyword">const</span> i = (f + <span class="hljs-number">1</span>) % <span class="hljs-number">7</span>
  <span class="hljs-keyword">return</span> i &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">7</span> + i : i
}

<span class="hljs-keyword">const</span> decodeStep = (f) =&gt; STEPS[unaltered(f)]
<span class="hljs-keyword">const</span> decodeAlt = (f) =&gt; <span class="hljs-built_in">Math</span>.floor((f + <span class="hljs-number">1</span>) / <span class="hljs-number">7</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>‘FCGDAEB’ steps numbers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> STEPS = [<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>]
<span class="hljs-comment">/**
 * Decode a pitch to its numeric properties
 * @param {Pitch}
 * @return {Object}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode</span> (<span class="hljs-params">p</span>) </span>{
  <span class="hljs-keyword">const</span> s = decodeStep(p[<span class="hljs-number">1</span>])
  <span class="hljs-keyword">const</span> a = decodeAlt(p[<span class="hljs-number">1</span>])
  <span class="hljs-keyword">const</span> o = isNum(p[<span class="hljs-number">2</span>]) ? p[<span class="hljs-number">2</span>] + <span class="hljs-number">4</span> * a + FIFTH_OCTS[s] : <span class="hljs-literal">null</span>
  <span class="hljs-keyword">return</span> { step: s, alt: a, oct: o, dir: p[<span class="hljs-number">3</span>] || <span class="hljs-literal">null</span> }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h4 id="pitch-parsers">Pitch parsers</h4>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Convert from string to pitches is a quite expensive operation that it’s
executed a lot of times. Some caching will help:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> cached = (parser) =&gt; {
  <span class="hljs-keyword">const</span> cache = {}
  <span class="hljs-keyword">return</span> (str) =&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> str !== <span class="hljs-string">'string'</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    <span class="hljs-keyword">return</span> cache[str] || (cache[str] = parser(str))
  }
}

<span class="hljs-comment">/**
 * Parse a note name
 * @function
 * @param {String}
 * @return {Pitch}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> parseNote = cached((str) =&gt; {
  <span class="hljs-keyword">const</span> n = noteParse(str)
  <span class="hljs-keyword">return</span> n ? encode(n.step, n.alt, n.oct) : <span class="hljs-literal">null</span>
})

<span class="hljs-comment">/**
 * Test if the given string is a note name
 * @function
 * @param {String}
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isNoteStr = (s) =&gt; parseNote(s) !== <span class="hljs-literal">null</span>

<span class="hljs-comment">/**
 * Parses an interval name in shorthand notation
 * @function
 * @param {String}
 * @return {Pitch}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> parseIvl = cached((str) =&gt; {
  <span class="hljs-keyword">const</span> i = ivlNttn.parse(str)
  <span class="hljs-keyword">return</span> i ? encode(i.simple - <span class="hljs-number">1</span>, i.alt, i.oct, i.dir) : <span class="hljs-literal">null</span>
})

<span class="hljs-comment">/**
 * Test if the given string is an interval name
 * @function
 * @param {String}
 * @return {Boolean}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> isIvlPitchStr = (s) =&gt; parseIvl(s) !== <span class="hljs-literal">null</span>


<span class="hljs-keyword">const</span> parsePitch = (str) =&gt; parseNote(str) || parseIvl(str)</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <h3 id="pitch-to-string">Pitch to string</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-comment">/**
 * Given a step number return the letter
 * @function
 * @param {Integer}
 * @return {String}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> toLetter = (s) =&gt; <span class="hljs-string">'CDEFGAB'</span>[s % <span class="hljs-number">7</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Repeat a string num times</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> fillStr = (s, num) =&gt; <span class="hljs-built_in">Array</span>(<span class="hljs-built_in">Math</span>.abs(num) + <span class="hljs-number">1</span>).join(s)

<span class="hljs-comment">/**
 * Given an alteration number, return the accidentals
 *
 * @function
 * @param {Integer}
 * @return {String}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> toAcc = (n) =&gt; fillStr(n &lt; <span class="hljs-number">0</span> ? <span class="hljs-string">'b'</span> : <span class="hljs-string">'#'</span>, n)
<span class="hljs-keyword">const</span> strNum = (n) =&gt; n !== <span class="hljs-literal">null</span> ? n : <span class="hljs-string">''</span>

<span class="hljs-comment">/**
 * Given a pitch class or a pitch note, get the string in scientific
 * notation
 *
 * @param {Pitch}
 * @return {String}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">strNote</span> (<span class="hljs-params">n</span>) </span>{
  <span class="hljs-keyword">const</span> p = isPitch(n) &amp;&amp; !n[<span class="hljs-number">3</span>] ? decode(n) : <span class="hljs-literal">null</span>
  <span class="hljs-keyword">return</span> p ? toLetter(p.step) + toAcc(p.alt) + strNum(p.oct) : <span class="hljs-literal">null</span>
}</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>is an interval ascending?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> isAsc = (p) =&gt; p.dir === <span class="hljs-number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>is an interval perfectable?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> isPerf = (p) =&gt; ivlNttn.type(p.step + <span class="hljs-number">1</span>) === <span class="hljs-string">'P'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>calculate interval number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> calcNum = (p) =&gt; isAsc(p) ? p.step + <span class="hljs-number">1</span> + <span class="hljs-number">7</span> * p.oct : (<span class="hljs-number">8</span> - p.step) - <span class="hljs-number">7</span> * (p.oct + <span class="hljs-number">1</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>calculate interval alteration</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> calcAlt = (p) =&gt; isAsc(p) ? p.alt : isPerf(p) ? -p.alt : -(p.alt + <span class="hljs-number">1</span>)

<span class="hljs-comment">/**
 * Given an interval, get the string in scientific
 * notation
 *
 * @param {Pitch}
 * @return {String}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">strIvl</span> (<span class="hljs-params">pitch</span>) </span>{
  <span class="hljs-keyword">const</span> p = isIvlPitch(pitch) ? decode(pitch) : <span class="hljs-literal">null</span>
  <span class="hljs-keyword">if</span> (!p) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">const</span> num = calcNum(p)
  <span class="hljs-keyword">return</span> p.dir * num + ivlNttn.altToQ(num, calcAlt(p))
}

<span class="hljs-keyword">const</span> strPitch = (p) =&gt; p[<span class="hljs-number">3</span>] ? strIvl(p) : strNote(p)</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h4 id="decorate-pitch-transform-functions">Decorate pitch transform functions</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> notation = (parse, str) =&gt; (v) =&gt; !isPitch(v) ? parse(v) : str(v)

<span class="hljs-keyword">const</span> asNote = notation(parseNote, id)
<span class="hljs-keyword">const</span> asIvl = notation(parseIvl, id)
<span class="hljs-keyword">const</span> asPitch = notation(parsePitch, id)

<span class="hljs-keyword">const</span> toNoteStr = notation(id, strNote)
<span class="hljs-keyword">const</span> toIvlStr = notation(id, strIvl)
<span class="hljs-keyword">const</span> toPitchStr = notation(id, strPitch)</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>create a function decorator to work with pitches</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> pitchOp = (parse, to) =&gt; (fn) =&gt; (v) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>is value in array notation?…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> isP = isPitch(v)</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>then no transformation is required</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (isP) <span class="hljs-keyword">return</span> fn(v)</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>else parse the pitch</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> p = parse(v)</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>if parsed, apply function and back to string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> p ? to(fn(p)) : <span class="hljs-literal">null</span>
}
<span class="hljs-keyword">const</span> noteFn = pitchOp(parseNote, toNoteStr)
<span class="hljs-keyword">const</span> ivlFn = pitchOp(parseIvl, toIvlStr)
<span class="hljs-keyword">const</span> pitchFn = pitchOp(parsePitch, toPitchStr)

<span class="hljs-comment">/**
 * Given a string return a note string in scientific notation or null
 * if not valid string
 *
 * @function
 * @param {String}
 * @return {String}
 * @example
 * ['c', 'db3', '2', 'g+', 'gx4'].map(tonal.note)
 * // =&gt; ['C', 'Db3', null, null, 'G##4']
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> note = noteFn(id)</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <h4 id="pitch-properties">Pitch properties</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-comment">/**
 * Get pitch class of a note. The note can be a string or a pitch array.
 *
 * @function
 * @param {String|Pitch}
 * @return {String} the pitch class
 * @example
 * tonal.pc('Db3') // =&gt; 'Db'
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> pc = noteFn((p) =&gt; [ <span class="hljs-string">'tnl'</span>, p[<span class="hljs-number">1</span>] ])

<span class="hljs-comment">/**
 * Return the chroma of a pitch.
 *
 * @function
 * @param {String|Pitch}
 * @return {Integer}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> chroma = pitchFn((n) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-number">7</span> * n[<span class="hljs-number">1</span>] - <span class="hljs-number">12</span> * fOcts(n[<span class="hljs-number">1</span>])
})</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
