<!DOCTYPE html>

<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>index.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { encode, asArr, transpose } <span class="hljs-keyword">from</span> <span class="hljs-string">'tonal'</span>

<span class="hljs-comment">/**
 * A regex to match roman numbers literals with the from:
 * `[accidentals]roman[element]` where:
 *
 * accidentals: (Optional) one or two flats (b) or shaprs (#)
 * roman: (Required) a roman numeral from I to VII either in upper or lower case
 * element: (Optional) a name of an element
 *
 * @name roman.regex
 *
 * @example
 * r.exec('bVII')
 * r.exec('IVMaj7')
 * r.exec('ii minor')
 */</span>
<span class="hljs-keyword">const</span> ROMAN = <span class="hljs-regexp">/^\s*(b|bb|#|##|)(IV|III|II|I|VII|VI|V|iv|iii|ii|i|vii|vi|v)\s*(.*)\s*$/</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> romanRegex = () =&gt; ROMAN

<span class="hljs-keyword">var</span> NUM = {i: <span class="hljs-number">0</span>, ii: <span class="hljs-number">1</span>, iii: <span class="hljs-number">2</span>, iv: <span class="hljs-number">3</span>, v: <span class="hljs-number">4</span>, vi: <span class="hljs-number">5</span>, vii: <span class="hljs-number">6</span>}

<span class="hljs-comment">/**
 * Parse a chord expressed with roman numerals. It returns an interval representing
 * the root of the chord relative to the key tonic and the chord name.
 *
 * @param {String} str - the roman numeral string
 * @return {Object} the roman number in array notation or null if not valid numeral
 *
 * @example
 * var parse = require('music-notation/roman.parse')
 * parse('V7') // =&gt; { root: ['tnl', 1, 0, 0, 1], name: '7'}
 * parse('bIIalt') // =&gt; [ root: ['tnl', -5, 0, 2, 1], name: 'alt']
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseRomanChord</span> (<span class="hljs-params">str</span>) </span>{
  <span class="hljs-keyword">var</span> m = ROMAN.exec(str)
  <span class="hljs-keyword">if</span> (!m) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  <span class="hljs-keyword">var</span> num = NUM[m[<span class="hljs-number">2</span>].toLowerCase()]
  <span class="hljs-keyword">var</span> alt = m[<span class="hljs-number">1</span>].length
  <span class="hljs-keyword">if</span> (m[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'b'</span>) alt = -alt
  <span class="hljs-keyword">return</span> { root: encode(num, alt, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>), name: m[<span class="hljs-number">3</span>] }
}

<span class="hljs-comment">/**
 * Get chord progression from a tonic and chord in roman numerals
 *
 * @param {String} tonic - the tonic
 * @param {Array|String} progression - the progression in roman numerals
 * @return {Array} the chord progression
 *
 * @example
 * var progression = require('chord-progression')
 * progression('I IIm7 V7', 'C') // =&gt; ['C', 'Dm7', 'G7']
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">progression</span> (<span class="hljs-params">chords, tonic</span>) </span>{
  <span class="hljs-keyword">return</span> asArr(chords).map((e) =&gt; {
    <span class="hljs-keyword">const</span> r = parseRomanChord(e)
    <span class="hljs-keyword">return</span> r ? transpose(r.root, tonic) + r.name : <span class="hljs-literal">null</span>
  })
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
