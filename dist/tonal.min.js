"use strict";var isArr=Array.isArray;function isStr(s){return typeof s==="string"}var FIFTHS=[0,2,4,-1,1,3,5];function pitchClass(lnum,alt){return[FIFTHS[lnum||0]+7*(alt||0)]}function _fifthOct(f){return Math.floor(f*7/12)}function pitch(lnum,alt,oct){var pc=pitchClass(lnum,alt);return!oct&&oct!==0?pc:[pc[0],oct-_fifthOct(pc[0])]}function isPitch(p){return isArr(p)&&p.length===2}function _ppl(letter){var cc=letter.charCodeAt(0);return(cc>96?cc-92:cc-60)%7}function _ppa(acc){var alt=acc.replace(/x/g,"##").length;return acc[0]==="b"?-alt:alt}function _ppo(o){return o?+o:null}var PITCH_REGEX=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d{0,1})$/;function pitchRegex(){return PITCH_REGEX}function parse(str){var m=PITCH_REGEX.exec(str);return m?pitch(_ppl(m[1]),_ppa(m[2]),_ppo(m[3])):null}function fifthsBase(num){var i=(num+1)%7;return i<0?7+i:i}var LETTERS="FCGDAEB";function letter(p){return LETTERS[fifthsBase(isArr(p)?p[0]:p)]}function alt(p){return isArr(p)?Math.floor((p[0]+1)/7):+p}function accidentals(p){var a=alt(p);return a?Array(Math.abs(a)+1).join(a<0?"b":"#"):""}function hasOct(pitch){return typeof pitch[1]!=="undefined"}var oct=function oct(def){return function(p){return hasOct(p)?p[1]+_fifthOct(p[0]):def}};var octStr=oct("");function str(p){return letter(p)+accidentals(p)+octStr(p)}var sci=map([str,parse]);sci.str=str;sci.parse=parse;sci.regex=pitchRegex;function interval(num,alt,oct,dir){return pitch(num,alt,oct).concat(dir)}function isInterval(i){return isArr(i)&&i.length===3}var SIMPLES=[3,0,4,1,5,2,6];function simple(i){return isArr(i)?SIMPLES[fifthsBase(i[0])]:(i-1)%7}function number(i){return simple(i)+1+7*oct(0)(i)}function qNum(i){return i[0]}function direction(i){return i[4]}function type(i){return TYPES[simple(i)]}var ALTER={P:["dddd","ddd","dd","d","P","A","AA","AAA","AAAA"],M:["ddd","dd","d","m","M","A","AA","AAA","AAAA"]};function quality(i){return ALTER[type(i)][4+alt(i)]}var IVL_TNL="([-+]?)(\\d+)(d{1,4}|m|M|P|A{1,4}|b{1,4}|#{1,4})";var IVL_STR="(AA|A|P|M|m|d|dd)([-+]?)(\\d+)";var COMPOSE="(?:("+IVL_TNL+")|("+IVL_STR+"))";var IVL_REGEX=new RegExp("^"+COMPOSE+"$");function ivlRegex(){return IVL_REGEX}var TYPES="PMMPPMM";var QALT={P:{dddd:-4,ddd:-3,dd:-2,d:-1,P:0,A:1,AA:2,AAA:3,AAAA:4},M:{ddd:-4,dd:-3,d:-2,m:-1,M:0,A:1,AA:2,AAA:3,AAAA:4}};function _ipq(simple,q){return q===""?0:q[0]==="#"?q.length:q[0]==="b"?-q.length:QALT[TYPES[simple]][q]}function ivlParse(str){var m=IVL_REGEX.exec(str);if(!m)return null;var num=+(m[3]||m[8]);var sim=simple(num);var alt=_ipq(sim,m[4]||m[6]||"");var oct=Math.floor((num-1)/7);var dir=(m[2]||m[7])==="-"?-1:1;return interval(sim,alt,oct,dir)}function dirStr(p){return direction(p)===-1?"-":""}function ivlStr(p){return dirStr(p)+number(p)+quality(p)}var ivl=combine([ivlStr,ivlParse]);ivl.parse=ivlParse;ivl.str=ivlStr;ivl.regex=ivlRegex;var tr=function tr(a){return function(b){var ac=sci.parse(a)||ivl.parse(a)||a;var bc=sci.parse(b)||ivl.parse(b)||b;var n=isInterval(ac)&&isPitch(bc)?trBy(ac,bc):isPitch(ac)&&isInterval(bc)?trBy(bc,ac):null;return n?sci.str(n):null}};function trBy(ivl,p){return pitch.length===1?[ivl[2]*ivl[0]+p[0]]:[ivl[2]*ivl[0]+p[0],ivl[2]*ivl[1]+p[1]]}function op(parse,fn){return function(a){return fn(isStr(a)?parse(a):a)}}var SEP=/\s*\|\s*|\s*,\s*|\s+/;function split(source){return isArr(source)?source:typeof source==="string"?source.trim().split(SEP):source===null||typeof source==="undefined"?[]:[source]}function combine(arr){var fns=arr.slice().reverse();return function(e){return fns.reduce(function(e,fn){return fn(e)},e)}}function map(fn,list){if(arguments.length===1)return function(l){return map(fn,l)};if(isArr(fn))fn=combine(fn);return split(list).map(fn)}var _p=function _p(fn){return op(sci.parse,fn)};module.exports={pitchClass:pitchClass,pitch:pitch,letter:_p(letter),accidentals:accidentals,oct:oct,sci:sci,interval:interval,number:number,simple:simple,qNum:qNum,ivl:ivl,type:type,quality:quality,tr:tr,combine:combine,map:map};exports.pitchClass=pitchClass;exports.pitch=pitch;