<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>distance/index.js - Postman Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-chord.html">chord</a><ul class='methods'><li data-type='method'><a href="module-chord.html#.exists">exists</a></li><li data-type='method'><a href="module-chord.html#.intervals">intervals</a></li><li data-type='method'><a href="module-chord.html#.names">names</a></li><li data-type='method'><a href="module-chord.html#.notes">notes</a></li><li data-type='method'><a href="module-chord.html#.position">position</a></li><li data-type='method'><a href="module-chord.html#.tokenize">tokenize</a></li></ul></li><li><a href="module-distance.html">distance</a><ul class='methods'><li data-type='method'><a href="module-distance.html#.add">add</a></li><li data-type='method'><a href="module-distance.html#.fifths">fifths</a></li><li data-type='method'><a href="module-distance.html#.interval">interval</a></li><li data-type='method'><a href="module-distance.html#.semitones">semitones</a></li><li data-type='method'><a href="module-distance.html#.subtract">subtract</a></li><li data-type='method'><a href="module-distance.html#.transpose">transpose</a></li><li data-type='method'><a href="module-distance.html#.transposeBy">transposeBy</a></li><li data-type='method'><a href="module-distance.html#.trFifths">trFifths</a></li></ul></li><li><a href="module-interval.html">interval</a><ul class='methods'><li data-type='method'><a href="module-interval.html#.build">build</a></li><li data-type='method'><a href="module-interval.html#.chroma">chroma</a></li><li data-type='method'><a href="module-interval.html#.fromSemitones">fromSemitones</a></li><li data-type='method'><a href="module-interval.html#.ic">ic</a></li><li data-type='method'><a href="module-interval.html#.invert">invert</a></li><li data-type='method'><a href="module-interval.html#.name">name</a></li><li data-type='method'><a href="module-interval.html#.num">num</a></li><li data-type='method'><a href="module-interval.html#.props">props</a></li><li data-type='method'><a href="module-interval.html#.semitones">semitones</a></li><li data-type='method'><a href="module-interval.html#.simplify">simplify</a></li><li data-type='method'><a href="module-interval.html#.type">type</a></li></ul></li><li><a href="module-key.html">key</a></li><li><a href="module-note.html">note</a><ul class='methods'><li data-type='method'><a href="module-note.html#.alt">alt</a></li><li data-type='method'><a href="module-note.html#.freq">freq</a></li><li data-type='method'><a href="module-note.html#.fromMidi">fromMidi</a></li><li data-type='method'><a href="module-note.html#.midi">midi</a></li><li data-type='method'><a href="module-note.html#.name">name</a></li><li data-type='method'><a href="module-note.html#.oct">oct</a></li><li data-type='method'><a href="module-note.html#.pc">pc</a></li><li data-type='method'><a href="module-note.html#.step">step</a></li></ul></li><li><a href="module-pcset.html">pcset</a><ul class='methods'><li data-type='method'><a href="module-pcset.html#.chroma">chroma</a></li><li data-type='method'><a href="module-pcset.html#.filter">filter</a></li><li data-type='method'><a href="module-pcset.html#.includes">includes</a></li><li data-type='method'><a href="module-pcset.html#.intervals">intervals</a></li><li data-type='method'><a href="module-pcset.html#.isChroma">isChroma</a></li><li data-type='method'><a href="module-pcset.html#.isEqual">isEqual</a></li><li data-type='method'><a href="module-pcset.html#.isSubset">isSubset</a></li><li data-type='method'><a href="module-pcset.html#.isSuperset">isSuperset</a></li><li data-type='method'><a href="module-pcset.html#.modes">modes</a></li></ul></li><li><a href="module-scale.html">scale</a><ul class='methods'><li data-type='method'><a href="module-scale.html#.exists">exists</a></li><li data-type='method'><a href="module-scale.html#.names">names</a></li><li data-type='method'><a href="module-scale.html#.notes">notes</a></li><li data-type='method'><a href="module-scale.html#.tokenize">tokenize</a></li></ul></li><li><a href="module-tonal.html">tonal</a></li></ul><h3>Global</h3><ul><li><a href="global.html#permutations">permutations</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">distance/index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * [![npm version](https://img.shields.io/npm/v/tonal-distance.svg)](https://www.npmjs.com/package/tonal-distance)
 * [![tonal](https://img.shields.io/badge/tonal-distance-yellow.svg)](https://github.com/danigb/tonal/tree/master/packages/tonal/distance)
 * 
 * Transpose notes by intervals and find distances between notes
 *
 * @example
 * // using ES6 import
 * import { interval, semitones, transpose } from 'tonal-distance'
 * semitones('C' ,'D') // => 2
 * interval('C4', 'G4') // => '5P'
 * transpose('C4', 'P5') // => 'G4'
 *
 * // included in tonal facade
 * const tonal = require('tonal');
 * tonal.distance.transpose('C4', 'P5')
 * tonal.distance.transposeBy('P5', 'C4')
 * 
 * @module distance
 */
import { props as nprops, build as nbuild } from "tonal-note/index";
import { props as iprops, build as ibuild } from "tonal-interval/index";

// Map from letter step to number of fifths starting from 'C':
// { C: 0, D: 2, E: 4, F: -1, G: 1, A: 3, B: 5 }
const FIFTHS = [0, 2, 4, -1, 1, 3, 5];

// Given a number of fifths, return the octaves they span
const fOcts = f => Math.floor(f * 7 / 12);

// Get the number of octaves it span each step
const FIFTH_OCTS = FIFTHS.map(fOcts);

const encode = ({ step, alt, oct, dir = 1 }) => {
  const f = FIFTHS[step] + 7 * alt;
  if (oct === null) return [dir * f];
  const o = oct - FIFTH_OCTS[step] - 4 * alt;
  return [dir * f, dir * o];
};

// We need to get the steps from fifths
// Fifths for CDEFGAB are [ 0, 2, 4, -1, 1, 3, 5 ]
// We add 1 to fifths to avoid negative numbers, so:
// for ['F', 'C', 'G', 'D', 'A', 'E', 'B'] we have:
const STEPS = [3, 0, 4, 1, 5, 2, 6];

// Return the number of fifths as if it were unaltered
function unaltered(f) {
  const i = (f + 1) % 7;
  return i &lt; 0 ? 7 + i : i;
}

const decode = (f, o, dir) => {
  const step = STEPS[unaltered(f)];
  const alt = Math.floor((f + 1) / 7);
  if (o === undefined) return { step, alt, dir };
  const oct = o + 4 * alt + FIFTH_OCTS[step];
  return { step, alt, oct, dir };
};

const memo = (fn, cache = {}) => str => cache[str] || (cache[str] = fn(str));

const encoder = props =>
  memo(str => {
    const p = props(str);
    return p.name === null ? null : encode(p);
  });

const encodeNote = encoder(nprops);
const encodeIvl = encoder(iprops);

/**
 * Transpose a note by an interval. The note can be a pitch class.
 * 
 * This function can be partially applied.
 * 
 * @param {String} note
 * @param {String} interval
 * @return {String} the transposed note
 * @example
 * import { tranpose } from 'tonal-distance'
 * transpose('d3', '3M') // => 'F#3'
 * // it works with pitch classes
 * transpose('D', '3M') // => 'F#'
 * // can be partially applied
 * ['C', 'D', 'E', 'F', 'G'].map(transpose('M3)) // => ['E', 'F#', 'G#', 'A', 'B']
 */
export function transpose(note, interval) {
  if (arguments.length === 1) return i => transpose(note, i);
  const n = encodeNote(note);
  const i = encodeIvl(interval);
  if (n === null || i === null) return null;
  const tr = n.length === 1 ? [n[0] + i[0]] : [n[0] + i[0], n[1] + i[1]];
  return nbuild(decode(tr[0], tr[1]));
}

/**
 * Transpose a pitch class by a number of perfect fifths. 
 * 
 * It can be partially applied.
 *
 * @function
 * @param {String} pitchClass - the pitch class 
 * @param {Integer} fifhts - the number of fifths
 * @return {String} the transposed pitch class
 * 
 * @example
 * import { trFifths } from 'tonal-transpose'
 * [0, 1, 2, 3, 4].map(trFifths('C')) // => ['C', 'G', 'D', 'A', 'E']
 * // or using tonal
 * tonal.trFifths('G4', 1) // => 'D'
 */

export function trFifths(note, fifths) {
  if (arguments.length === 1) return f => trFifths(note, f);
  const n = encodeNote(note);
  if (n === null) return null;
  return nbuild(decode(n[0] + fifths));
}

/**
 * Get the distance in fifths between pitch classes
 * 
 * Can be partially applied.
 * 
 * @param {String} to - note or pitch class
 * @param {String} from - note or pitch class 
 */
export function fifths(from, to) {
  if (arguments.length === 1) return to => fifths(from, to);
  const f = encodeNote(from);
  const t = encodeNote(to);
  if (t === null || f === null) return null;
  return t[0] - f[0];
}

/**
 * The same as transpose with the arguments inverted.
 * 
 * Can be partially applied.
 * 
 * @param {String} note
 * @param {String} interval
 * @return {String} the transposed note
 * @example
 * import { tranposeBy } from 'tonal-distance'
 * transposeBy('3m', '5P') // => '7m'
 */
export function transposeBy(interval, note) {
  if (arguments.length === 1) return n => transpose(n, interval);
  return transpose(note, interval);
}

const isDescending = e => e[0] * 7 + e[1] * 12 &lt; 0;
const decodeIvl = i =>
  isDescending(i) ? decode(-i[0], -i[1], -1) : decode(i[0], i[1], 1);

export function addIntervals(ivl1, ivl2, dir) {
  const i1 = encodeIvl(ivl1);
  const i2 = encodeIvl(ivl2);
  if (i1 === null || i2 === null) return null;
  const i = [i1[0] + dir * i2[0], i1[1] + dir * i2[1]];
  return ibuild(decodeIvl(i));
}

/**
 * Add two intervals 
 * 
 * Can be partially applied.
 * 
 * @param {String} interval1
 * @param {String} interval2
 * @return {String} the resulting interval
 * @example
 * import { add } from 'tonal-distance'
 * add('3m', '5P') // => '7m'
 */
export function add(ivl1, ivl2) {
  if (arguments.length === 1) return i2 => add(ivl1, i2);
  return addIntervals(ivl1, ivl2, 1);
}

/**
 * Subtract two intervals
 * 
 * Can be partially applied
 * 
 * @param {String} minuend
 * @param {String} subtrahend
 * @return {String} interval diference
 */
export function subtract(ivl1, ivl2) {
  if (arguments.length === 1) return i2 => add(ivl1, i2);
  return addIntervals(ivl1, ivl2, -1);
}

/**
 * Find the interval between two pitches. It works with pitch classes 
 * (both must be pitch classes and the interval is always ascending)
 * 
 * Can be partially applied
 *
 * @param {String} from - distance from
 * @param {String} to - distance to
 * @return {String} the interval distance
 *
 * @example
 * import { interval } from 'tonal-distance'
 * interval('C2', 'C3') // => 'P8'
 * interval('G', 'B') // => 'M3'
 * 
 * // or use tonal
 * var tonal = require('tonal')
 * tonal.distance.interval('M2', 'P5') // => 'P4'
 */
export function interval(from, to) {
  if (arguments.length === 1) return t => interval(from, t);
  const f = encodeNote(from);
  const t = encodeNote(to);
  if (f === null || t === null || f.length !== t.length) return null;
  const d =
    f.length === 1
      ? [t[0] - f[0], -Math.floor((t[0] - f[0]) * 7 / 12)]
      : [t[0] - f[0], t[1] - f[1]];
  return ibuild(decodeIvl(d));
}

/**
 * Get the distance between two notes in semitones
 * 
 * @param {String|Pitch} from - first note
 * @param {String|Pitch} to - last note
 * @return {Integer} the distance in semitones or null if not valid notes
 * @example
 * import { semitones } from 'tonal-distance'
 * semitones('C3', 'A2') // => -3
 * // or use tonal
 * tonal.distance.semitones('C3', 'G3') // => 7
 */
export function semitones(from, to) {
  if (arguments.length === 1) return t => semitones(from, t);
  const f = nprops(from);
  const t = nprops(to);
  return f.midi !== null &amp;&amp; t.midi !== null
    ? t.midi - f.midi
    : f.chroma !== null &amp;&amp; t.chroma !== null
      ? (t.chroma - f.chroma + 12) % 12
      : null;
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated at Tue Sep 26 2017 23:04:35 GMT+0200 (CEST)
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
