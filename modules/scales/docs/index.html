<!DOCTYPE html>

<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>index.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">import</span> { parseIvl, harmonize, map, pc, chroma, noteRange } <span class="hljs-keyword">from</span> <span class="hljs-string">'tonal'</span>
<span class="hljs-keyword">const</span> raw = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./scales.json'</span>)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> DATA = <span class="hljs-built_in">Object</span>.keys(raw).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d, k</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>add intervals</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  d[k] = raw[k][<span class="hljs-number">0</span>].split(<span class="hljs-string">' '</span>).map(parseIvl)</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>add alias</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (raw[k][<span class="hljs-number">1</span>]) raw[k][<span class="hljs-number">1</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a</span>) </span>{ d[a] = k })
  <span class="hljs-keyword">return</span> d
}, {})

<span class="hljs-keyword">const</span> harmonizer = (ivls) =&gt; (tonic) =&gt; harmonize(ivls, tonic || <span class="hljs-string">'P1'</span>)

<span class="hljs-comment">/**
 * Create a scale from a name or intervals and tonic
 *
 * @param {Array} source - the scale name, scale intervals or scale notes
 * @param {String} tonic - the tonic of the scale
 * @return {Array} the list of notes
 *
 * @example
 * const scale = require('tonal-scales')
 * // get scale from type and tonic
 * scale('major', 'A4') // =&gt; ['A4', 'B4', 'C#4', 'D4', 'E4', 'F#4', 'G#4']
 * // get scale from intervals and tonic
 * scale('1 2 3 4 5 6 7', 'A') // =&gt; ['A', 'B', 'C#', 'D', 'E', 'F#', 'G#']
 * // partially applied
 * const major = scale('major')
 * major('A') // =&gt; ['A', 'B', 'C#', 'D', 'E', 'F#', 'G#']
 * major('A4') // =&gt; ['A4', 'B4', 'C#4', 'D4', 'E4', 'F#4', 'G#4']
 * // part of tonal
 * tonal.scale('major', 'A')
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scale</span> (<span class="hljs-params">source, tonic</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> scale(source)(tonic)
  <span class="hljs-keyword">var</span> intervals = DATA[source]</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>is an alias?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> intervals === <span class="hljs-string">'string'</span>) intervals = DATA[intervals]
  <span class="hljs-keyword">return</span> harmonizer(intervals || source)
}

<span class="hljs-comment">/**
 * Get scale notes by scale name
 *
 * @param {String} name - the complete scale name (with tonic)
 * @return {Array} scale notes
 *
 * @example
 * const scales = require('tonal-scales')
 * scales.fromName('A major') // =&gt; ['A', 'B', 'C#', 'D', 'E', 'F#', 'G#']
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fromName</span>(<span class="hljs-params">name</span>) </span>{
  <span class="hljs-keyword">const</span> i = name.indexOf(<span class="hljs-string">' '</span>)
  <span class="hljs-keyword">if</span> (i === <span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span> scale(name, <span class="hljs-literal">false</span>)
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> scale(name.slice(i + <span class="hljs-number">1</span>), name.slice(<span class="hljs-number">0</span>, i))
}

<span class="hljs-comment">/**
 * Return the available scale names
 *
 * @param {boolean} aliases - true to include aliases
 * @return {Array} an array of scale names
 *
 * @example
 * const scales = require('tonal-scales')
 * scales.names() // =&gt; ['maj7', ...]
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">names</span> (<span class="hljs-params">aliases</span>) </span>{
  <span class="hljs-keyword">if</span> (aliases) <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.keys(DATA)
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.keys(DATA).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">names, name</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> DATA[name] !== <span class="hljs-string">'string'</span>) names.push(name)
    <span class="hljs-keyword">return</span> names
  }, [])
}

<span class="hljs-keyword">const</span> buildNote = (pc, midi) =&gt; pc + (<span class="hljs-built_in">Math</span>.floor(midi / <span class="hljs-number">12</span>) - <span class="hljs-number">1</span>)
<span class="hljs-keyword">const</span> pitchSetGen = (notes) =&gt; {
  <span class="hljs-keyword">const</span> scale = map(pc, notes)
  <span class="hljs-keyword">const</span> chromas = map(chroma, scale)
  <span class="hljs-keyword">return</span> (midi) =&gt; {
    <span class="hljs-keyword">const</span> pcIndex = chromas.indexOf(midi % <span class="hljs-number">12</span>)
    <span class="hljs-keyword">return</span> pcIndex &gt; <span class="hljs-number">-1</span> ? buildNote(scale[pcIndex], midi) : <span class="hljs-literal">null</span>
  }
}

<span class="hljs-comment">/**
 * Create a scale range. It accepts a scale name or scale notes.
 *
 * @param {String|Array} src - the scale name or scale notes
 * @param {String} start - the first note of the range
 * @param {String} end - the last note of the range
 * @return {Array} the scale range, an empty array if not valid source or
 * null if not valid start or end
 * @example
 * import { scaleRange } from 'tonal-scales'
 * scalesRange('C bebbop', 'C3', 'C2')
 * // =&gt; [ 'C3', 'B2', 'Bb2', 'A2', 'G2', 'F2', 'E2', 'D2', 'C2' ]
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scaleRange</span>(<span class="hljs-params">src, start, end</span>) </span>{
  <span class="hljs-keyword">const</span> scale = fromName(src)
  <span class="hljs-keyword">return</span> noteRange(pitchSetGen(scale.length ? scale : src), start, end)
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
